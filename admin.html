<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administraci√≥n - Royal Caf√©</title>
  <style>
    body {
      background-color: #2c1a10;
      color: #ffe9c4;
      font-family: 'Lora', serif;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .reserva {
      border: 1px solid #f0b45c;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      background-color: #4b2d1a;
    }
    button {
      margin-top: 10px;
      background-color: #f0b45c;
      color: #2c1a10;
      border: none;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #e69e3d;
    }
  </style>
</head>
<body>
  <h1>Panel de Administraci√≥n - Royal Caf√©</h1>
  <div id="adminInfo"></div>
  <div id="contenedorReservas">Cargando reservas...</div>

  <script>
    const BACKEND_URL = 'https://royalcafe-backend.onrender.com';

    const urlParams = new URLSearchParams(window.location.search);
    const admin = urlParams.get('admin') || 'Desconocido';
    document.getElementById('adminInfo').innerText = `Administrador: ${admin}`;

    function cargarReservas() {
      fetch(`${BACKEND_URL}/reservas`)
        .then(res => res.json())
        .then(reservas => {
          const contenedor = document.getElementById('contenedorReservas');
          contenedor.innerHTML = '';

          if (reservas.length === 0) {
            contenedor.innerHTML = '<p>No hay reservas existentes.</p>';
            return;
          }

          reservas.forEach(r => {
            const div = document.createElement('div');
            div.className = 'reserva';
            div.innerHTML = `
              <strong>VR:</strong> ${r.fields.NombreVR || ''}<br>
              <strong>Discord:</strong> ${r.fields.Discord || ''}<br>
              <strong>Patreon:</strong> ${r.fields.Patreon || ''}<br>
              <strong>Rango:</strong> ${r.fields.Rango || ''}<br>
              <strong>Tipo:</strong> ${r.fields.Tipo || ''}<br>
              <strong>Opci√≥n:</strong> ${r.fields.Opcion || ''}<br>
              <strong>Fecha:</strong> ${r.fields.Fecha || ''}<br>
              <strong>Especificaciones:</strong> ${r.fields.Especificaciones || ''}<br>
              <button onclick="confirmarCita('${r.id}')">‚úÖ Confirmar</button>
              <button onclick="eliminarCita('${r.id}')">üóëÔ∏è Eliminar</button>
            `;
            contenedor.appendChild(div);
          });
        })
        .catch(err => {
          document.getElementById('contenedorReservas').innerHTML = 'Error al cargar reservas';
        });
    }

    function eliminarCita(id) {
      fetch(`${BACKEND_URL}/reservas/${id}`, { method: 'DELETE' })
        .then(() => cargarReservas());
    }

    function confirmarCita(id) {
      fetch(`${BACKEND_URL}/reservas/${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ fields: { Confirmada: true } })
      }).then(() => cargarReservas());
    }

    cargarReservas();
  </script>
</body>
</html>
